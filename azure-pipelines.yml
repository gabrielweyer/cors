resources:
- repo: self
pool:
  name: Hosted Ubuntu 1604

steps:

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@3
  displayName: Install Yarn 1.16.0
  inputs:
    versionSpec: 1.16.0

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@3
  displayName: yarn install
  inputs:
    arguments: install

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@3
  displayName: yarn lint
  inputs:
    aguments: lint

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-task.Yarn@3
  displayName: yarn build-prod
  inputs:
    arguments: build-prod

- task: geeklearningio.gl-vsts-tasks-file-patch.json-patch-task.JsonPatch@3
  displayName: Version web Artifact
  inputs:
    JsonWorkingDir: 'dist/'
    JsonTargetFilters: environment.json
    JsonPatchContent: |
     = /build => "$(BUILD_BUILDNUMBER)"
     = /commit=> "$(BUILD_SOURCEVERSION)"
    OutputPatchFile: true
    FailIfNoPatchApplied: true

- task: PublishBuildArtifacts@1
  displayName: Publish Artifact - web
  inputs:
    PathtoPublish: 'dist/'
    ArtifactName: web
    publishLocation: Container

- task: PublishBuildArtifacts@1
  displayName: Publish Artifact - ARM
  inputs:
    PathtoPublish: 'template/template.json'
    ArtifactName: arm
    publishLocation: Container
